<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <!-- Dynamic SEO -->
  <title id="meta-title">Blog | Calming Currents Beauty Spa</title>
  <meta id="meta-description" name="description" content="Massage therapy and wellness tips from Calming Currents Beauty Spa Johannesburg."/>

  <!-- Schema container -->
  <script type="application/ld+json" id="blog-schema">
  {}
  </script>

  <style>
    body{
      font-family: Arial, sans-serif;
      line-height: 1.7;
      background:#fff;
      color:#333;
      max-width:900px;
      margin:auto;
      padding:2rem;
    }

    h1{
      color:#0a3d62;
      margin-bottom:0.5rem;
    }

    .date{
      color:#888;
      margin-bottom:2rem;
      display:block;
    }

    .content p{
      margin-bottom:1rem;
    }

    .back{
      display:inline-block;
      margin-bottom:2rem;
      color:#0a3d62;
      text-decoration:none;
      font-weight:600;
    }
  </style>
</head>

<body>

  <a href="/blog.html" class="back">‚Üê Back to Blog</a>

  <article>
    <h1 id="post-title">Loading...</h1>
    <span class="date" id="post-date"></span>
    <div id="post-content" class="content"></div>
  </article>


<script>
/* ===============================
   CONTENTFUL SETTINGS
================================ */
const SPACE_ID = "09muo917z9ra";
const ACCESS_TOKEN = "Z2-ybwP2VOWRp1wNWpxaaAl0P8sekgACZD-QXYDFrdw";


/* ===============================
   GET SLUG FROM URL
================================ */
const params = new URLSearchParams(window.location.search);
const slug = params.get("slug");

if(!slug){
  document.getElementById("post-title").innerText = "Post not found";
  throw new Error("No slug provided");
}


/* ===============================
   FETCH SINGLE POST
================================ */
async function fetchPost(){

  const res = await fetch(
    `https://cdn.contentful.com/spaces/${SPACE_ID}/environments/master/entries?access_token=${ACCESS_TOKEN}&content_type=blogPost&fields.slug=${slug}`
  );

  const data = await res.json();

  if(!data.items.length){
    document.getElementById("post-title").innerText = "Post not found";
    return;
  }

  const item = data.items[0].fields;

  const title = item.title;
  const date = item.publishedDate;
  const content = item.content;


  /* ===============================
     CONVERT CONTENTFUL RICH TEXT
  ================================= */
  const text = content.content
    .map(block => block.content?.map(c => c.value).join("") || "")
    .join("\n\n");


  /* ===============================
     INJECT INTO PAGE
  ================================= */
  document.getElementById("post-title").innerText = title;
  document.getElementById("post-date").innerText =
    new Date(date).toLocaleDateString();

  document.getElementById("post-content").innerHTML =
    text.split("\n\n").map(p => `<p>${p}</p>`).join("");


  /* ===============================
     DYNAMIC SEO
  ================================= */
  document.title = title + " | Calming Currents Beauty Spa";

  document
    .getElementById("meta-description")
    .setAttribute("content", text.substring(0,150));


  /* ===============================
     BLOG POST SCHEMA
  ================================= */
  const schema = {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": title,
    "datePublished": date,
    "author": {
      "@type": "Organization",
      "name": "Calming Currents Beauty Spa"
    },
    "description": text.substring(0,150),
    "mainEntityOfPage": window.location.href
  };

  document.getElementById("blog-schema").textContent =
    JSON.stringify(schema);
}

fetchPost();
</script>

</body>
  </html>
