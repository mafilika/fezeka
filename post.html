<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title id="meta-title">Loading...</title>
  <meta id="meta-description" name="description" content="">
</head>
<body>

<a href="/blog.html">‚Üê Back to Blog</a>

<h1 id="title"></h1>
<p id="date"></p>
<div id="content"></div>

<script src="https://unpkg.com/@contentful/rich-text-html-renderer@15.12.0/dist/rich-text-html-renderer.umd.js">
</script>
<script>
const SPACE_ID = "09muo917z9ra";
const ACCESS_TOKEN = "Z2-ybwP2VOWRp1wNWpxaaAl0P8sekgACZD-QXYDFrdw";

const params = new URLSearchParams(window.location.search);
const slug = params.get("slug");

async function loadPost() {
  const res = await fetch(
    `https://cdn.contentful.com/spaces/${SPACE_ID}/environments/master/entries?access_token=${ACCESS_TOKEN}&content_type=blogPost&fields.slug[in]=${slug}&include=1`
  );

  const data = await res.json();

  if (!data.items.length) {
    document.getElementById("content").innerHTML = "<p>Post not found.</p>";
    return;
  }

  const item = data.items[0].fields;

  // Set title & date
  document.getElementById("title").innerText = item.title;
  document.getElementById("date").innerText = new Date(item.publishedDate).toLocaleDateString();
  document.title = item.title;

  // Output HTML content
  document.getElementById("content").innerHTML = item.content;

  // ====== Add BlogPosting schema ======
  const plainText = item.content.replace(/<[^>]+>/g, '').substring(0, 160);

  const schema = {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": item.title,
    "description": plainText,
    "datePublished": item.publishedDate,
    "dateModified": item.publishedDate,
    "mainEntityOfPage": window.location.href,
    "author": {
      "@type": "Organization",
      "name": "Calming Currents Beauty Spa"
    },
    "publisher": {
      "@type": "Organization",
      "name": "Calming Currents Beauty Spa",
      "logo": {
        "@type": "ImageObject",
        "url": "https://calmingcurrentsbeautyspa.com/images/logo.png"
      }
    }
  };

  if(item.featuredImage?.fields?.file?.url){
    schema.image = "https:" + item.featuredImage.fields.file.url;
  }

  const script = document.createElement("script");
  script.type = "application/ld+json";
  script.textContent = JSON.stringify(schema);
  document.head.appendChild(script);
}

loadPost();
</script>

</body>
</html>
